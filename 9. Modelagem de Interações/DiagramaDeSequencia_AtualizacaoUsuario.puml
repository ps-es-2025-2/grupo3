@startuml
title Diagrama de Sequência – Atualizar Dados Pessoais

actor "Usuário" as usuario
participant "TelaPerfil" as ui <<boundary>>
participant "ControladorAutenticacao" as ctrl <<control>>
participant "Usuario" as user <<entity>>
participant "RepositoryUsuarios" as repo <<repository>>

activate usuario

== Atualizar Dados Pessoais ==

usuario -> ui : 1: acessarPaginaEdicao()
activate ui

ui -> ctrl : 2: carregarDadosUsuario(idUsuario)
activate ctrl

ctrl -> repo : 2.1: buscarUsuario(idUsuario)
activate repo
repo --> ctrl : 2.1.1: dadosUsuario
deactivate repo

ctrl --> ui : 2.2: exibirDadosAtuais(dadosUsuario)
deactivate ctrl

ui --> usuario : 2.3: mostrarFormularioEdicao()

usuario -> ui : 3: atualizarDados(dadosAtualizados)

ui -> ctrl : 4: validarESalvar(dadosAtualizados)
activate ctrl

' ========== Validação dos dados ==========
alt Dados inválidos
    ctrl --> ui : 4.1e: notificarDadosInvalidos(mensagem)
    ui --> usuario : 4.2e: solicitarCorrecao(mensagem)
else Dados válidos
    ctrl -> user : 4.1: atualizarInformacoes(dadosAtualizados)
    activate user
    user --> ctrl : 4.1.1: dadosAtualizados
    deactivate user

    ctrl -> repo : 4.2: salvarAlteracoes(user)
    activate repo

    alt Sucesso
        repo --> ctrl : 4.2.1: confirmacao
        ctrl --> ui : 4.3: atualizacaoConfirmada()
        ui --> usuario : 4.4: notificarSucesso()
    else Falha no salvamento
        repo --> ctrl : 4.2.2: erroAtualizacao
        ctrl --> ui : 4.3e: notificarErroAtualizacao(mensagem)
        ui --> usuario : 4.4e: exibirMensagemErro(mensagem)
    end

    deactivate repo
end

deactivate ctrl
deactivate ui
deactivate usuario

@enduml